<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Music Station </title>
		<!-- Description, Keywords and Author -->
		<meta name="description" content="Music Station USAC">
		<meta name="keywords" content="Proyecto 2">
		<meta name="author" content="IPC 1">
		<!-- Ajuste de la pantalla -->
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<!-- Styles -->
		<!-- Bootstrap CSS -->
		<link href="css/bootstrap.min.css" rel="stylesheet">	
		<!-- Animate CSS -->
		<link href="css/animate.min.css" rel="stylesheet">
		<!-- Basic stylesheet -->
		<link rel="stylesheet" href="css/owl.carousel.css">
		<!-- Font awesome CSS -->
		<link href="css/font-awesome.min.css" rel="stylesheet">		
		<!-- Custom CSS -->
		<link href="css/style.css" rel="stylesheet">
		<link href="css/style-color.css" rel="stylesheet">
		<!-- Favicon -->
		<link rel="shortcut icon" href="img/logo/favicon.ico">	
	</head>
	
	<body onload="cargarCanciones(), buscarUsuario(), obtenerPlaylist()" id="main">
		
		<!-- wrapper -->
		<div class="wrapper" id="home">
			<!-- header area -->
			<header>
				<!-- secondary menu -->
				<nav class="secondary-menu">
					<div class="container">
						<!-- secondary menu left link area -->
						<div class="sm-left">
							<strong>Estudiante</strong>:&nbsp; <a href="#nombreEstudiante">Jos&eacute; Pajoc</a>&nbsp;&nbsp;&nbsp;&nbsp;
							<strong>Curso</strong>:&nbsp; <a href="#curso">Instroducci&oacute;n a la programaci&oacute;n y computaci&oacute;n 1</a>
						</div>
						<div class="clearfix"></div>
					</div>
				</nav>
				<!-- primary menu -->
				<nav class="navbar navbar-fixed-top navbar-default">
					<div class="container">
						<!-- Brand and toggle get grouped for better mobile display -->
						<div class="navbar-header">
							<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
								<span class="sr-only">Toggle navigation</span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
							</button>
							<!-- logo area -->
							<a class="navbar-brand" href="#home">
								<!-- logo image -->
								<img class="img-responsive" src="img/logo/logo.png" alt="USAC" />
							</a>
						</div>

						<!-- Menú principal utilizando una lista en posición horizontal -->
						<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
							<ul class="nav navbar-nav navbar-right">
								<li><a href="#playList">Canciones disponibles</a></li>
								<li><a href="#verPlayList">Mi Playlist</a></li>
								<li><a href="#events">Solicitar canci&oacute;n</a></li>		
								<li><a href="#nuevoUsuario">Mi perfil</a></li>
								<li><a href="../index.html">Salir</a></li>
							</ul>
						</div><!-- /.navbar-collapse -->
					</div><!-- /.container-fluid -->
				</nav>
			</header>
			<!--/ header end -->			
							
			<!-- portada -->
			<div class="banner">
				<div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
					<!-- Wrapper for slides -->
					<div class="carousel-inner" role="listbox">
						<div class="item active">
							<img src="img/banner/b1.jpg" alt="...">
							<div class="container">
								<!-- banner caption -->
								<div class="carousel-caption slide-one">
									<!-- heading -->
									<h2 class="animated fadeInLeftBig"><i class="fa fa-music"></i>Bienvenido, <script>document.write(sessionStorage.getItem('usuario'));</script></h2>
									<!-- paragraph -->
									<h3 class="animated fadeInRightBig">El lugar perfecto para toda tu m&uacute;sica</h3>
								</div>
							</div>
						</div>
						<div class="item">
							<img src="img/banner/b2.jpg" alt="...">
							<div class="container">
								<!-- banner caption -->
								<div class="carousel-caption slide-two">
									<!-- heading -->
									<h2 class="animated fadeInLeftBig"><i class="fa fa-headphones"></i> Music Station - USAC</h2>
									<!-- paragraph -->
									<h3 class="animated fadeInRightBig">Personaliza tu lista de reproducci&oacute;n</h3>
								</div>
							</div>
						</div>
					</div>
					
					<!-- Control navegación banner -->
					<a class="left carousel-control" href="#carousel-example-generic" role="button" data-slide="prev">
						<span class="fa fa-arrow-left" aria-hidden="true"></span>
					</a>
					<a class="right carousel-control" href="#carousel-example-generic" role="button" data-slide="next">
						<span class="fa fa-arrow-right" aria-hidden="true"></span>
					</a>
				</div>
			</div>
			<!--/ portada end -->
			
			<!-- portada navigation menu -->
			<div class="nav-animate"></div>
			
			<!-- lista canciones -->
			<div id="playList" class="hero pad">
				<div class="container">
					<!-- hero content -->
					<div class="hero-content ">
						<!-- heading -->
						<h2>Canciones registradas</h2>
						<hr>
						<!-- paragraph -->
						<p>Actualmente las <strong>canciones</strong> en el sistema son:</p>
					</div>
					<!-- hero play list -->
					<div class="hero-playlist">
							<div class="col-md-10 col-sm-6">
								<!-- play list -->
								<div class="playlist-content">
									<ul class="list-unstyled"  id="listaCanciones">
									    <!-- área para cargar las canciones registradas -->
										
									</ul>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!--/ lista canciones end -->
			
			<!-- lista usuarios -->
			<div id="verPlayList" class="promo parallax-one pad">
				<div class="container">
					<!-- promo element -->
					<div class="promo-element ">
						<!-- heading -->
						<h3>Mi PlayList</h3>
						
						<!-- tabla para play list  -->
						<font color="#ffffff">
							<table class="table">
								<thead>
									<tr>
										<th scope="col">Nombre</th>
										<th scope="col">Artista</th>
										<th scope="col">Canci&oacute;n</th>
									</tr>
								</thead>
								<!-- tbody para play list -->
								<tbody id="miPlaylist">
								
								</tbody>
							</table>
						</font>
					</div>
				</div>
			</div>
			<!-- lista usuarios end -->
			
			<script>
				function cargarCanciones(){
						var listaCanciones = document.querySelector('#listaCanciones') 
						fetch('https://proyecto2-201115455.herokuapp.com/canciones')	
						.then(response => response.json())
						.catch(error =>{ 
							console.log("No se cargo las canciones")
						})
						.then(res => {
							listaCanciones.innerHTML = " "            <!-- limpiando la tabla para no tener duplicidad-->
							for(var j in res){
									listaCanciones.innerHTML +=
									 ` <li class="playlist-number">
											<!-- song information -->
											<div class="song-info" > <!-- canción agregada desde el servidor -->
												<h2>${res[j].nombre}</h2> 
												<iframe src="${res[j].linkSpotify}" width="300" height="80" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>
													<strong>Artista: </strong>${res[j].artista}    				&nbsp;   |&nbsp; 
													<button type="button" value="${res[j].id}" onclick="verCancion(this)" class="btn btn-primary">Ver detalles</button>
													<button type="button" value="${res[j].id}" onclick="agregarPlaylist(this)" class="btn btn-success">Agregar a mi Playlist</button>
											</div>
											<div class="clearfix"></div>
										</li>  `
							}	
						})	
				}
								
				function verCancion(boton){ 						<!-- función para ver detalles de la canción-->
					var idCancion = boton.value
					sessionStorage.setItem("buscarCancion", idCancion)     <!-- guardando en session storage el id de la canción para buscar -->
					location.href="../verCancion/verCancion.html"
				}
				
				function agregarPlaylist(boton){
					var idCancion = boton.value
					var usuarioPlaylist = sessionStorage.getItem('usuario')
					
					var url = "https://proyecto2-201115455.herokuapp.com/playList/" + usuarioPlaylist  + "/" + idCancion
					var objetoLista = {'usuario': usuarioPlaylist, 'idCancion': idCancion}
							fetch(url, {
									method: 'POST', 
									body: JSON.stringify(objetoLista), 
									headers:{
										'Content-Type': 'application/json'   
									}
							})
							.then(res => res.json())   //variable respuesta guardará lo que recibe como respuesta en formato JSON si sale bien la API
							.catch(err => {
									alert("No se pudo conectar con el servidor")
							})
							.then(response =>{ 
									if(response.mensaje == "exito"){
											alert("Información: " + response.Descripcion)  //mensaje de entrada
											obtenerPlaylist()
									}else{
											alert("Error: " + response.Descripcion)  //concatenando mensaje del JSON de la API
											
									}
							})
				}
			</script>
			
			<script>
				var playListUsuario = " "      <!-- variable para almacenar la play list en el front -->
				
				function obtenerPlaylist(){
						var usuarioBuscar = sessionStorage.getItem('usuario')
						var url = "https://proyecto2-201115455.herokuapp.com/playList/" + usuarioBuscar
						fetch(url)	
						.then(response => response.json())
						.catch(error =>{ 
								console.log("No se pudo obtener la lista de reproduccion")
						})
						.then(res => {
								if(res.mensaje=='exito'){
										playListUsuario = res.listaReproduccion
										console.log(playListUsuario)
										mostrarPlaylist()
								}else{
										console.log('No se pudo cargar el play list')
								}
						})	
				}	
				
				function mostrarPlaylist(){
						var playListCanciones = document.querySelector('#miPlaylist') 
						miPlaylist.innerHTML = " "            <!-- limpiando la tabla para no tener duplicidad-->
						for(var x in playListUsuario){
								var url = "https://proyecto2-201115455.herokuapp.com/cancion/" + playListUsuario[x]
								fetch(url)	
								.then(response => response.json())
								.catch(error =>{ 
										console.log("No se pudo agregar a la tabla del playlist")
								})
								.then(res => {
										console.log(res)
											miPlaylist.innerHTML +=
														`<tr>
																<th>  ${res.nombre} </th>
																<th>  ${res.artista} </th>
																<th><iframe src="${res.linkSpotify}" width="300" height="80" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe></th>
														</tr>`
								})
						}
				}
			</script>
			
			<!-- solicitar canciones -->
			<div class="events parallax-three pad" id="events">
				<div class="container">
					<!-- default heading -->
					<div class="default-heading-shadow">
						<!-- heading -->
						<h2>Solicitar canci&oacute;n</h2>
					</div>
							<font color="#ffffff">
							<center><h3>Debe llenar todos los campos para que un administrador pueda aprobar su solicitud:</h3></center>
							<form>
								<fieldset>
										<div class="form-group">
											<label for="nombre">Nombre:</label>
											<input type="text" class="form-control" id="nombreSolicitud" Placeholder="Nombre completo de la canción">
										</div>
										<div class="form-group">
											<label for="artista">Artista:</label>
											<input type="text" class="form-control" id="artistaSolicitud" Placeholder="Nombre completo del artista o grupo musical">
										</div>
								</fieldset>
								<fieldset>
										<div class="form-group">
											<label for="album">Album:</label>
											<input type="text" class="form-control" id="albumSolicitud" Placeholder="Nombre completo del album">
										</div>
										<div class="form-group">
											<label for="fecha">fecha:</label>
											<input type="text" class="form-control" id="fechaSolicitud" Placeholder="Año de lanzamiento">
										</div>
									
								</fieldset>	
										<div class="form-group">
											<label for="imagen">Link Imagen:</label>
											<input type="text" class="form-control" id="imagenSolicitud" Placeholder="Link del sitio web que aloja la imagen">
										</div>
										<div class="form-group">
											<label for="spotify">Link Spotify:</label>
											<input type="text" class="form-control" id="spotifySolicitud" Placeholder="Link proporcionado por Spotify">
										</div>
										<div class="form-group">
											<label for="youtube">Link Youtube:</label>
											<input type="text" class="form-control" id="youtubeSolicitud" Placeholder="Link proporcionado por Youtube">
										</div>
									
               <!-- botones de control -->
                <div class="form-group">    
                    <center><button onclick="enviarSolicitud()" type="button" class="btn btn-primary">Enviar solicitud</button></center>
                </div>
            </form>
						</font>
				</div>
			</div>
			<!-- solicitar canciones end -->
			
			<script>
					function enviarSolicitud(){
							var nombreSolicitud = document.querySelector('#nombreSolicitud').value
							var artistaSolicitud = document.querySelector('#artistaSolicitud').value
							var albumSolicitud = document.querySelector('#albumSolicitud').value
							var fechaSolicitud = document.querySelector('#fechaSolicitud').value
							var imagenSolicitud = document.querySelector('#imagenSolicitud').value
							var spotifySolicitud = document.querySelector('#spotifySolicitud').value
							var youtubeSolicitud = document.querySelector('#youtubeSolicitud').value
        
							// Objeto con estructura JSON
							var objetoSolicitud = { 'nombre': nombreSolicitud, 'artista': artistaSolicitud, 'album': albumSolicitud, 
																'fecha': fechaSolicitud, 'imagen': imagenSolicitud , 'linkSpotify': spotifySolicitud 
																, 'linkYoutube': youtubeSolicitud}
							var url = "https://proyecto2-201115455.herokuapp.com/solicitarCancion"
							fetch(url, {
									method: 'POST', 
									body: JSON.stringify(objetoSolicitud), // Convertimos nuestros datos en un JSON legible para la API
									headers:{
										'Content-Type': 'application/json'   // Los headers le indica con que tipo de aplicacion trabaja la API
									}
							})
							.then(res => res.json())   //variable respuesta guardará lo que recibe como respuesta en formato JSON si sale bien la API
							.catch(err => {
									alert("No se pudo conectar con el servidor")
							})
							.then(response =>{ 
									if(response.mensaje == "fallo"){
											alert("Error: " + response.Descripcion)  //concatenando mensaje del JSON de la API
									}else{
											alert("Información: " + response.Descripcion)  //mensaje de entrada
											location.href="inicioEstandar.html"
									}
							})
					}  //Fin de la función enviarSolicitud
		
			</script>
						
			<!-- mapa -->
			<div class="meet parallax-four pad" id="meet">
				<div class="container">
					<!-- default heading -->
					<div class="default-heading-shadow">
						<h2>Unidos a trav&eacute;s de la m&uacute;sica</h2>
					</div>
					<!-- meet location image -->
					<div class="meet-map">
						<img class="img-responsive img-map" src="img/flat/map.png" alt="" />
						<!-- map marker for India  -->
						<a href="#" class="map-marker india " data-toggle="tooltip" data-placement="top" title="India"><img class="img-responsive" src="img/flat/map-marker.png" alt="" /></a>
						<!-- map marker for United States  -->
						<a href="#" class="map-marker usa " data-toggle="tooltip" data-placement="top" title="United States"><img class="img-responsive" src="img/flat/map-marker.png" alt="" /></a>
						<!-- map marker for South Africa  -->
						<a href="#" class="map-marker sa " data-toggle="tooltip" data-placement="top" title="South Africa"><img class="img-responsive" src="img/flat/map-marker.png" alt="" /></a>
						<!-- map marker for Russia  -->
						<a href="#" class="map-marker russia " data-toggle="tooltip" data-placement="top" title="Russia"><img class="img-responsive" src="img/flat/map-marker.png" alt="" /></a>
						<!-- map marker for Brazil  -->
						<a href="#" class="map-marker brazil " data-toggle="tooltip" data-placement="top" title="Brazil"><img class="img-responsive" src="img/flat/map-marker.png" alt="" /></a>
					</div>
				</div>
			</div>
			<!-- mapa end -->
			
			<!-- form nuevo administrador -->
			<div class="contact pad" id="nuevoUsuario">
				<div class="container">
					<!-- default heading -->
					<div class="default-heading">
						<!-- heading -->
						<h2>Editar Perfil</h2>
					</div>
					<!-- form administrador -->
					<div class="form-content ">	
						<form role="form" id="contactForm" method="post">
							<div class="row">
								<div class="col-md-6 col-sm-6">
									<div class="form-group">
										<label for="name">Nombre</label>
										<input type="text" class="form-control" id="nombre" name="name" >
									</div>
									<div class="form-group">
										<label for="lastname">Apellido</label>
										<input type="text" class="form-control" id="apellido" name="lastname" >
									</div>
									<div class="form-group">
										<label for="username">usuario</label>
										<input type="text" class="form-control" id="nomUsuario" name="username" >
									</div>
								</div>
								<div class="col-md-6 col-sm-6">
										<div class="form-group">
												<div class="form-group">
														<label for="password">Password</label>
														<input type="text" class="form-control" id="contrasenia" name="password" >
												</div>
												<div class="form-group">
														<label for="confirmpassword">Confirmar password</label>
														<input type="password" class="form-control" id="confirmarContra" name="confirmpassword" >
												</div>
										</div>
								</div>
							</div>
							<div class="text-center">
								<button onclick="actualizarPerfil()" type="button" class="btn btn-lg btn-theme">Actualizar</button>
							</div>
						</form>						
					</div>
				</div>
			</div>
			<!-- form admnistrador end -->
			
			<script>
					function buscarUsuario(){
						var usuarioBuscar = sessionStorage.getItem('usuario')
						var url = "https://proyecto2-201115455.herokuapp.com/usuario/" + usuarioBuscar
						fetch(url)
						.then(response => response.json())
						.catch(error => {
								console.log("No se pudo conectar con el servidor")
						})
						.then(res =>{
							document.querySelector('#nombre').value = res.nombre
							document.querySelector('#apellido').value = res.apellido
							document.querySelector('#nomUsuario').value = res.usuario
							document.querySelector('#contrasenia').value = res.password
						})
					}			
					
					var nombreOriginal = ""
					var nuevoNombre = ""
					function actualizarPerfil(){
							var nomUsuarioOriginal = sessionStorage.getItem('usuario')
							var nombre = document.querySelector('#nombre').value
							var apellido = document.querySelector('#apellido').value
							var nomUsuario = document.querySelector('#nomUsuario').value
							nombreOriginal = sessionStorage.getItem('usuario')
							nuevoNombre = document.querySelector('#nomUsuario').value
							var password = document.querySelector('#contrasenia').value
							var confirmarContra = document.querySelector('#confirmarContra').value
        
							if(password==confirmarContra){
								// Objeto con estructura JSON
								var objetoUsuario = { 'nombreNew': nombre, 'apellidoNew': apellido, 'nomUsuarioNew': nomUsuario, 'contraNew': password}
								var url = "https://proyecto2-201115455.herokuapp.com/usuario/" + nomUsuarioOriginal
								console.log(objetoUsuario) // ver objeto JSON en la consola del navegador
								fetch(url, {
										method: 'PUT',
										body: JSON.stringify(objetoUsuario), // Siempre convertir en JSON nuestro objeto
										headers:{
											'Content-Type': 'application/json'
										} 
								})
								.then(res => res.json())
								.catch(error => {
										alert("Ocurrio un error, revisar la consola")
								})
								.then(response =>{ 
										if(response.mensaje == "fallo"){
											alert("Error: " + response.Descripcion)  //concatenando mensaje del JSON de la API
										}else{
											actualizarNombrePlaylist()
											alert("Información: " + response.Descripcion)	
											sessionStorage.setItem("usuario",nomUsuario)  //Guardar en memoria el usuario
											
											location.href="inicioEstandar.html"
										}
								}) 
							}else{
								alert("Las contraseñas no coinciden")
							}
					}  //Fin de la función actualizar perfil
					
					function actualizarNombrePlaylist(){
						
						// Objeto con estructura JSON
						var objetoUsuario = { 'nombreNew': nuevoNombre}
								var url = "https://proyecto2-201115455.herokuapp.com/playList/" + nombreOriginal
								fetch(url, {
										method: 'PUT',
										body: JSON.stringify(objetoUsuario), // Siempre convertir en JSON nuestro objeto
										headers:{
											'Content-Type': 'application/json'
										} 
								})
								.then(res => res.json())
								.catch(error => {
										alert("Ocurrio un error, revisar la consola")
								})
								.then(response =>{ 
										if(response.mensaje == "fallo"){
											console.log("Error: " + response.Descripcion)  //concatenando mensaje del JSON de la API
										}else{
											console.log("Información: " + response.Descripcion)
										}
								}) 
							
					}
		</script>
			
			<!-- footer -->
			<footer>
				<div class="container">
					<!-- social media links -->
					<div class="social">
						<a class="h-facebook" href="#"><i class="fa fa-facebook"></i></a>
						<a class="h-google" href="#"><i class="fa fa-google-plus"></i></a>
						<a class="h-linkedin" href="#"><i class="fa fa-linkedin"></i></a>
						<a class="h-twitter" href="#"><i class="fa fa-twitter"></i></a>
					</div>
					<!-- copy right -->
					<p class="copy-right">&copy; copyright 2020, All rights are reserved.</p>
				</div>
			</footer>
			<!-- footer end -->
			
			<!-- Scroll to top -->
			<span class="totop"><a href="#"><i class="fa fa-chevron-up"></i></a></span> 
		</div>
		
		<!-- Javascript files -->
		<!-- jQuery -->
		<script src="js/jquery.js"></script>
		<!-- Bootstrap JS -->
		<script src="js/bootstrap.min.js"></script>
		<!-- WayPoints JS -->
		<script src="js/waypoints.min.js"></script>
		<!-- Include js plugin -->
		<script src="js/owl.carousel.min.js"></script>
		<!-- One Page Nav -->
		<script src="js/jquery.nav.js"></script>
		<!-- Respond JS for IE8 -->
		<script src="js/respond.min.js"></script>
		<!-- HTML5 Support for IE -->
		<script src="js/html5shiv.js"></script>
		<!-- Custom JS -->
		<script src="js/custom.js"></script>
		<!-- agregando papa parse desde un cdn y JQUERY-->	
		<!--  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>   no se esta usando porque la plantilla ya tiene JQUERY dentro de sus archivos -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
		<!-- agregando enlace para jsPDF el cual fue descargado dentro de la carpeta js de la plantilla ya que no funciona con CDN-->
		<script src="js/jspdf.min.js" ></script>
		
	</body>	
</html>
